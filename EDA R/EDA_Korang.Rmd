---
title: "R Notebook"
output: html_notebook
---

# Tips
This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


# Library

```{r}
library(readr)
library(ggplot2)
library(tidyr)
library(dplyr)
library(shiny)
library(purrr)
library(knitr)
library(forcats)
library(rmarkdown)
library(tinytex)
library(naniar)
library(lubridate)
library(simputation)
library(visdat)
library(explore)
library(stringr)
```


# Import

Three files have been provided in "csv" format with descriptions as follows:

 1. **WellHeader_subset**: The subset provides the unique well identifier. Each row is a well leg. Columns are attributes.
 2. **WellProduction_subset**: Time series of well production per well.
 3. **PerfTreatment_subset**: Time schedule of activities performed on each well.

```{r}
wellHeader <- read_csv("WellHeader_Datathon_R1.csv")
wellProduction <- read_csv("WellProduction_R1.csv")
wellTreatment <- read_csv("PerfTreatments_R1.csv")
```

# EDA

## WellProduction

```{r}
# explore::explore(wellProduction)
```

```{r}
wellProduction_Tidy <- sample_n(wellProduction, 10000) %>% mutate(ProdType2 = case_when(
                             ProdType == "Production Hours" ~ "Prod_hrs",
                             ProdType == "Condensate Production (Bbls)" ~ "Prod_cond",
                             ProdType == "Water Production (Bbls)" ~ "Prod_water",
                             ProdType == "Oil Production (Bbls)" ~ "Prod_oil",
                             ProdType == "Gas Production (MMcf)" ~ "Prod_gas"))


wellProduction_tidy_wide <- wellProduction_Tidy %>% 
  # complete(EPAssetsId, ProdType2) %>%
  pivot_wider(names_from = ProdType2, values_from = Volume) %>% 
  select(-c(WellHeader.Match, ProdType)) %>% 
  mutate(ProdPeriod = ymd(ProdPeriod)) %>% 
  arrange(EPAssetsId, ProdPeriod) %>% 
  naniar::bind_shadow() %>% 
  naniar::add_label_shadow() 
  # group_by(EPAssetsId, ProdPeriod) %>% 
  # naniar::miss_scan_count(search = list(!is.numeric()))

head(wellProduction_tidy_wide)
#   mutate(ProdPeriod = ymd(ProdPeriod))
```


